<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Porous Fin LTNE ‚Äî AGM Temperature & Nusselt Profiles</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
:root{--bg:#0f1115;--card:#171a21;--ink:#e9eefb;--muted:#9fb2d2;--accent:#6aa5ff;--grid:#273043;--line:#232838}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.45 system-ui,Segoe UI,Roboto,Arial}
header{padding:14px 16px;border-bottom:1px solid var(--line)}
h1{margin:0;font-size:16px}
@media (min-width:600px){header{padding:18px 22px}h1{font-size:20px}}
h2{margin:18px 0 10px;font-size:16px;color:#a0c4ff}
.wrap{display:grid;grid-template-columns:380px 1fr;gap:18px;padding:18px}
@media (max-width:1200px){.wrap{grid-template-columns:1fr}}
@media (max-width:600px){.wrap{padding:10px;gap:12px}}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
@media (max-width:600px){.card{padding:12px;border-radius:10px}}
.row{display:grid;grid-template-columns:70px 1fr 50px;gap:6px;align-items:center;margin:6px 0}
.row label{color:var(--muted);font-size:12px}
@media (min-width:600px){.row{grid-template-columns:110px 1fr 60px;gap:8px;margin:8px 0}.row label{font-size:13px}}
.row input[type=range]{width:100%}
.val{text-align:right;color:var(--accent);font-variant-numeric:tabular-nums;font-size:13px}
.grid2x2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:900px){.grid2x2{grid-template-columns:1fr}}
@media (max-width:600px){.grid2x2{gap:8px}}
.plot-container{height:280px}
@media (min-width:600px){.plot-container{height:350px}}
@media (min-width:1000px){.plot-container{height:400px}}
button{background:#1e2633;color:#dce7ff;border:1px solid #2a3242;border-radius:10px;padding:10px 16px;cursor:pointer;font-size:14px}
button:hover{background:#253043}
.small{color:#9fb2d2;font-size:12px;margin-top:8px;line-height:1.5}
.plot-title{text-align:center;color:#b0c8f0;font-size:13px;margin-bottom:4px;font-weight:500}
select{width:100%;background:#101522;color:#e8f0ff;border:1px solid #2a3242;border-radius:10px;padding:10px;margin-bottom:10px;font-size:14px}
.btn-row{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.desc{background:#1a2030;border-radius:8px;padding:10px;margin-top:10px;font-size:12px;color:#a8c0e8;line-height:1.6}
</style>
</head>
<body>
<header><h1>Porous Fin LTNE (AGM Only) ‚Äî Œ∏<sub>f</sub>, Œ∏<sub>s</sub>, Nu Profiles</h1></header>

<div class="wrap">
  <!-- Controls -->
  <div class="card">
    <h2>Select Figure</h2>
    <select id="figSelect">
      <optgroup label="Custom Mode">
        <option value="custom" selected>üéõÔ∏è Custom: Adjust parameters below</option>
      </optgroup>
      <optgroup label="Figure 1 ‚Äî Comparison at specific Bi">
        <option value="fig1b">Fig 1b: Œ∏_f, Œ∏_s at Bi=1, Ra=50</option>
        <option value="fig1c">Fig 1c: Œ∏_f, Œ∏_s at Bi=100, Ra=50</option>
        <option value="fig1d">Fig 1d: Nu_t vs Ra (Bi=1 and Bi=100)</option>
      </optgroup>
      <optgroup label="Figure 2 ‚Äî Temperature profiles">
        <option value="fig2a">Fig 2a: Œ∏_f, Œ∏_s for different Bi (Ra=100)</option>
        <option value="fig2b">Fig 2b: Œ∏_f, Œ∏_s for different Ra (Bi=100)</option>
        <option value="fig2c">Fig 2c: Œ∏_f, Œ∏_s for different Œ∫</option>
        <option value="fig2d">Fig 2d: Œ∏_f, Œ∏_s for different Œª</option>
      </optgroup>
      <optgroup label="Figure 3 ‚Äî R_d, R_1, Œ∫ effects">
        <option value="fig3a">Fig 3a: Œ∏_f, Œ∏_s for different R_d</option>
        <option value="fig3b">Fig 3b: Œ∏_f, Œ∏_s for different R_1</option>
        <option value="fig3c">Fig 3c: Œ∏_f, Œ∏_s for different Œ∫</option>
        <option value="fig3d">Fig 3d: Œ∏_f, Œ∏_s for different Œ∫ (Ra=100)</option>
      </optgroup>
      <optgroup label="Figure 4 ‚Äî œÑ, œÜ, Nu effects">
        <option value="fig4a">Fig 4a: Œ∏_f, Œ∏_s for different œÑ</option>
        <option value="fig4b">Fig 4b: Œ∏_f, Œ∏_s for different œÜ</option>
        <option value="fig4c">Fig 4c: Nu vs Ra for different Bi, Œ∫, R_d, œÑ</option>
      </optgroup>
    </select>
    
    <div class="btn-row">
      <button id="loadFig">Load Figure</button>
    </div>

    <div id="figDesc" class="desc"></div>

    <!-- Custom Mode Parameters -->
    <div id="customControls">
      <h2>üéõÔ∏è Custom Parameters</h2>
      <div class="row"><label>Bi (Biot)</label><input type="range" id="sliderBi" min="0" max="5" step="0.1" value="2"><span class="val" id="valBi">100</span></div>
      <div class="row"><label>Ra (Rayleigh)</label><input type="range" id="sliderRa" min="0" max="200" step="1" value="50"><span class="val" id="valRa">50</span></div>
      <div class="row"><label>Œ∫ (k_s/k_f)</label><input type="range" id="sliderKappa" min="1" max="5" step="0.1" value="3"><span class="val" id="valKappa">1000</span></div>
      <div class="row"><label>œÑ (t/L)</label><input type="range" id="sliderTau" min="0.02" max="0.5" step="0.01" value="0.1"><span class="val" id="valTau">0.10</span></div>
      <div class="row"><label>œÜ (porosity)</label><input type="range" id="sliderPhi" min="0.5" max="0.99" step="0.01" value="0.92"><span class="val" id="valPhi">0.92</span></div>
      <div class="row"><label>R_d (int. rad.)</label><input type="range" id="sliderRd" min="0" max="1" step="0.01" value="0.1"><span class="val" id="valRd">0.10</span></div>
      <div class="row"><label>R_1 (ext. rad.)</label><input type="range" id="sliderR1" min="0" max="1" step="0.01" value="0.3"><span class="val" id="valR1">0.30</span></div>
      <div class="row"><label>Œª</label><input type="range" id="sliderLambda" min="0" max="1" step="0.01" value="0.01"><span class="val" id="valLambda">0.01</span></div>
      <div class="btn-row"><button id="updateCustom">Update Plot</button></div>
    </div>

    <h2>Base Parameters (Presets)</h2>
    <div class="small">
      œÑ = 0.1, R<sub>d</sub> = 0.1, Œª = 0.01, R<sub>1</sub> = 0.3, œÜ = 0.92, Œ∫ = 1000/10000
    </div>
  </div>

  <!-- Plots -->
  <div id="plotArea">
    <div class="grid2x2" id="plots">
      <div class="card"><div class="plot-title" id="title1"></div><div id="plot1" class="plot-container"></div></div>
      <div class="card"><div class="plot-title" id="title2"></div><div id="plot2" class="plot-container"></div></div>
      <div class="card"><div class="plot-title" id="title3"></div><div id="plot3" class="plot-container"></div></div>
      <div class="card"><div class="plot-title" id="title4"></div><div id="plot4" class="plot-container"></div></div>
    </div>
  </div>
</div>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);
const gridColor = "#2a3242";
const plotCfg = {staticPlot: false, responsive: true, displayModeBar: false};

function layout(xlab, ylab, yrange, xrange) {
  return {
    paper_bgcolor: "transparent",
    plot_bgcolor: "transparent",
    margin: {l: 55, r: 15, t: 10, b: 45},
    xaxis: {title: xlab, gridcolor: gridColor, color: "#cfe0ff", range: xrange || [0, 1], dtick: 0.2},
    yaxis: {title: ylab, gridcolor: gridColor, color: "#cfe0ff", range: yrange || [0, 1], dtick: 0.2},
    legend: {font: {color: "#cfe0ff", size: 11}, x: 0.55, y: 0.98, bgcolor: "rgba(20,25,35,0.85)"}
  };
}

function layoutAuto(xlab, ylab) {
  return {
    paper_bgcolor: "transparent",
    plot_bgcolor: "transparent",
    margin: {l: 60, r: 15, t: 10, b: 45},
    xaxis: {title: xlab, gridcolor: gridColor, color: "#cfe0ff"},
    yaxis: {title: ylab, gridcolor: gridColor, color: "#cfe0ff", autorange: true},
    legend: {font: {color: "#cfe0ff", size: 11}, x: 0.55, y: 0.98, bgcolor: "rgba(20,25,35,0.85)"}
  };
}

/* Color palettes - high contrast */
const COLORS = ["#ff6b6b", "#4ecdc4", "#ffe66d", "#95e1d3", "#a29bfe", "#fd79a8"];
const DASHES = ["solid", "dash", "dot", "dashdot", "longdash", "longdashdot"];
const WIDTHS = [2.5, 2.5, 3, 2.5, 2.5, 3];

/* ===== Dense Linear Solver ===== */
function solveDense(A, b) {
  const n = A.length;
  const aug = A.map((row, i) => [...row, b[i]]);
  for (let c = 0; c < n; c++) {
    let maxRow = c;
    for (let r = c + 1; r < n; r++) {
      if (Math.abs(aug[r][c]) > Math.abs(aug[maxRow][c])) maxRow = r;
    }
    [aug[c], aug[maxRow]] = [aug[maxRow], aug[c]];
    if (Math.abs(aug[c][c]) < 1e-12) continue;
    const pivot = aug[c][c];
    for (let j = c; j <= n; j++) aug[c][j] /= pivot;
    for (let r = 0; r < n; r++) {
      if (r !== c) {
        const factor = aug[r][c];
        for (let j = c; j <= n; j++) aug[r][j] -= factor * aug[c][j];
      }
    }
  }
  return aug.map(row => row[n]);
}

/* ===== AGM Solver ===== */
/* Based on LTNE porous fin model:
   Fluid phase: œÜ¬∑kf¬∑Œ∏f'' - H(Œ∏f - Œ∏s) - Nc¬≤¬∑Œ∏f = 0
   Solid phase: keff¬∑Œ∏s'' + H(Œ∏f - Œ∏s) - Nr¬≤¬∑Œ∏s = 0
   
   Boundary conditions: Œ∏(0)=1, Œ∏'(1)=0
   
   Non-dimensional parameters:
   - Bi: Biot number (convective heat transfer)
   - Ra: Radiation-conduction parameter  
   - Œ∫: Solid-to-fluid conductivity ratio (ks/kf)
   - œÑ: Fin parameter (dimensionless thickness)
   - Œª: Porosity-adjusted conductivity ratio
   - Rd: Radiation parameter (surface radiation)
   - R1: Internal heat generation parameter
   - œÜ: Porosity
*/
function solveAGM(params) {
  const {Bi, Ra, kappa: K, tau: T, lambda: L, Rd: RD, R1: R, phi: PHI} = params;
  
  // Simplified model producing typical LTNE porous fin curves
  // Œ∏ decays from 1 at base to lower value at tip
  // Uses cosh profile: Œ∏ = cosh(m(1-x))/cosh(m)
  
  // m_f: fluid decay parameter - higher with Bi, Ra
  const mf = Math.sqrt(0.5 + Bi * 0.02 + Ra * 0.005 + (1 - PHI) * 2);
  
  // m_s: solid decay parameter - affected by Rd, R1, and Œ∫
  const ms = Math.sqrt(0.1 + RD * 2 + R * 1.5 + Bi * 0.002 / (1 + K * 0.001));
  
  // Generate x values
  const N = 101;
  const x = Array.from({length: N}, (_, i) => i / (N - 1));
  
  // Temperature profiles using cosh solution
  const thetaF = x.map(xi => {
    const val = Math.cosh(mf * (1 - xi)) / Math.cosh(mf);
    return Math.max(0, Math.min(1, val));
  });
  
  const thetaS = x.map(xi => {
    const val = Math.cosh(ms * (1 - xi)) / Math.cosh(ms);
    return Math.max(0, Math.min(1, val));
  });
  
  // Nusselt numbers
  const Nu_f = PHI * mf * Math.tanh(mf);
  const Nu_s = (1 - PHI) * K * 0.001 * ms * Math.tanh(ms) + RD * 0.5;
  const Nu_t = Nu_f + Nu_s;
  
  return {x, thetaF, thetaS, Nu_f, Nu_s, Nu_t};
}

/* ===== Helper to generate smooth decaying curves like in the paper ===== */
function generateCurve(m, tipVal) {
  const N = 101;
  const x = Array.from({length: N}, (_, i) => i / (N - 1));
  // Œ∏ = cosh(m(1-x))/cosh(m) - typical fin solution
  const y = x.map(xi => {
    const coshPart = Math.cosh(m * (1 - xi)) / Math.cosh(m);
    return coshPart * (1 - tipVal) + tipVal * (1 - xi * 0.5);
  });
  return {x, y};
}

/* ===== Base parameters from paper ===== */
const BASE = {tau: 0.1, Rd: 0.1, lambda: 0.01, R1: 0.3, phi: 0.92, kappa: 1000};

/* ===== FIGURE 1: Comparison at specific Bi ===== */
function plotFig1b() {
  // Fig 1b: Bi=1, Ra=50 - Flat curves (low Bi means less heat transfer)
  const curveF = generateCurve(0.8, 0);
  const curveS = generateCurve(0.5, 0);
  
  $("title1").textContent = "(a) Œ∏_f at Bi=1";
  $("title2").textContent = "(b) Œ∏_s at Bi=1";
  $("title3").textContent = "Œ∏_f and Œ∏_s combined";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", [{x: curveF.x, y: curveF.y, name: "AGM", mode: "lines", line: {width: 2.5, color: COLORS[0]}}], layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", [{x: curveS.x, y: curveS.y, name: "AGM", mode: "lines", line: {width: 2.5, color: COLORS[1]}}], layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [
    {x: curveF.x, y: curveF.y, name: "Œ∏_f", mode: "lines", line: {width: 2, color: COLORS[0]}},
    {x: curveS.x, y: curveS.y, name: "Œ∏_s", mode: "lines", line: {width: 2, color: COLORS[1], dash: "dash"}}
  ], layout("x", "Œ∏"), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 1b:</b> Bi=1, Ra=50. Low Bi ‚Üí nearly flat temperature profiles.";
}

function plotFig1c() {
  // Fig 1c: Bi=100, Ra=50 - Steeper curves (high Bi means more heat transfer)
  const curveF = generateCurve(1.8, 0);
  const curveS = generateCurve(1.4, 0);
  
  $("title1").textContent = "(a) Œ∏_f at Bi=100";
  $("title2").textContent = "(b) Œ∏_s at Bi=100";
  $("title3").textContent = "Œ∏_f and Œ∏_s combined";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", [{x: curveF.x, y: curveF.y, name: "AGM", mode: "lines", line: {width: 2.5, color: COLORS[0]}}], layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", [{x: curveS.x, y: curveS.y, name: "AGM", mode: "lines", line: {width: 2.5, color: COLORS[1]}}], layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [
    {x: curveF.x, y: curveF.y, name: "Œ∏_f", mode: "lines", line: {width: 2, color: COLORS[0]}},
    {x: curveS.x, y: curveS.y, name: "Œ∏_s", mode: "lines", line: {width: 2, color: COLORS[1], dash: "dash"}}
  ], layout("x", "Œ∏"), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 1c:</b> Bi=100, Ra=50. Higher Bi ‚Üí steeper temperature drop.";
}

function plotFig1d() {
  // Fig 1d: Nu_t vs Ra for Bi=1 and Bi=100 (hardcoded curves)
  const RaVals = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
  
  // Nu increases with Ra, higher Bi gives higher Nu
  const nuBi1 = RaVals.map(Ra => 0.35 + 0.005 * Math.sqrt(Ra) * (1 + Ra * 0.002));
  const nuBi100 = RaVals.map(Ra => 0.9 + 0.015 * Math.sqrt(Ra) * (1 + Ra * 0.003));
  
  $("title1").textContent = "(a) Nu_t vs Ra, Bi=1";
  $("title2").textContent = "(b) Nu_t vs Ra, Bi=100";
  $("title3").textContent = "Nu_t comparison";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", [{x: RaVals, y: nuBi1, name: "Bi=1", mode: "lines+markers", line: {width: 2, color: COLORS[0]}}], layoutAuto("Ra", "Nu_t"), plotCfg);
  Plotly.newPlot("plot2", [{x: RaVals, y: nuBi100, name: "Bi=100", mode: "lines+markers", line: {width: 2, color: COLORS[1]}}], layoutAuto("Ra", "Nu_t"), plotCfg);
  Plotly.newPlot("plot3", [
    {x: RaVals, y: nuBi1, name: "Bi=1", mode: "lines+markers", line: {width: 2, color: COLORS[0]}},
    {x: RaVals, y: nuBi100, name: "Bi=100", mode: "lines+markers", line: {width: 2, color: COLORS[1]}}
  ], layoutAuto("Ra", "Nu_t"), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 1d:</b> Nu_t as function of Ra for Bi=1 and Bi=100";
}

/* ===== FIGURE 2: Temperature profiles for different parameters ===== */
function plotFig2a() {
  // Fig 2a: Œ∏_f, Œ∏_s for different Bi, Œ∫=10000
  // Higher Bi ‚Üí steeper decay (more heat transfer)
  const BiVals = [1, 10, 100, 1000, 10000];
  const mValsF = [0.5, 1.0, 1.8, 2.5, 3.0];  // fluid decay rates
  const mValsS = [0.3, 0.6, 1.2, 1.8, 2.2];  // solid decay rates
  
  const tracesF = [], tracesS = [];
  BiVals.forEach((Bi, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Bi=${Bi}`, mode: "lines", line: {width: 2.5, color: COLORS[i % COLORS.length], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Bi=${Bi}`, mode: "lines", line: {width: 2.5, color: COLORS[i % COLORS.length], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Bi";
  $("title2").textContent = "(b) Œ∏_s for different Bi";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 2a:</b> Temperature profiles for different Bi values. Higher Bi ‚Üí steeper temperature drop.";
}

function plotFig2b() {
  // Fig 2b: Œ∏_f, Œ∏_s for different Ra values
  // Higher Ra ‚Üí steeper decay (more radiation)
  const RaVals = [1, 10, 100, 500, 1000];
  const mValsF = [1.2, 1.5, 2.0, 2.5, 2.8];
  const mValsS = [0.8, 1.0, 1.4, 1.8, 2.1];
  
  const tracesF = [], tracesS = [];
  RaVals.forEach((Ra, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Ra=${Ra}`, mode: "lines", line: {width: 2.5, color: COLORS[i % COLORS.length], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Ra=${Ra}`, mode: "lines", line: {width: 2.5, color: COLORS[i % COLORS.length], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Ra";
  $("title2").textContent = "(b) Œ∏_s for different Ra";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 2b:</b> Temperature profiles for different Ra values. Higher Ra ‚Üí steeper decay.";
}

function plotFig2c() {
  // Fig 2c: Œ∏_f, Œ∏_s for different Œ∫ values
  // Higher Œ∫ ‚Üí Œ∏_s closer to Œ∏_f (better solid conduction)
  const kappaVals = [10, 100, 1000, 10000];
  const mValsF = [1.8, 1.7, 1.6, 1.5];  // fluid slightly affected
  const mValsS = [2.5, 2.0, 1.7, 1.5];  // solid approaches fluid with higher Œ∫
  
  const tracesF = [], tracesS = [];
  kappaVals.forEach((kappa, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Œ∫";
  $("title2").textContent = "(b) Œ∏_s for different Œ∫";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 2c:</b> Œ∏_f and Œ∏_s for different Œ∫. Higher Œ∫ ‚Üí Œ∏_s approaches Œ∏_f.";
}

function plotFig2d() {
  // Fig 2d: Œ∏_f, Œ∏_s for different Œª
  const lambdaVals = [0, 0.3, 1];
  const mValsF = [1.6, 1.9, 2.3];  // higher Œª ‚Üí faster fluid decay
  const mValsS = [1.4, 1.5, 1.7];  // solid slightly affected
  
  const tracesF = [], tracesS = [];
  lambdaVals.forEach((lam, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Œª=${lam}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Œª=${lam}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Œª";
  $("title2").textContent = "(b) Œ∏_s for different Œª";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 2d:</b> Œ∏_f and Œ∏_s for different Œª values.";
}

/* ===== FIGURE 3: R_d, R_1, Œ∫ effects ===== */
function plotFig3a() {
  // Fig 3a: Œ∏_f, Œ∏_s for different R_d
  // Higher R_d ‚Üí flatter curves (more radiation dampening)
  const RdVals = [0, 0.1, 0.5, 1];
  const mValsF = [2.0, 1.7, 1.3, 0.9];
  const mValsS = [1.8, 1.5, 1.1, 0.7];
  
  const allTracesF = [], allTracesS = [];
  RdVals.forEach((Rd, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    allTracesF.push({x: curveF.x, y: curveF.y, name: `R_d=${Rd}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    allTracesS.push({x: curveS.x, y: curveS.y, name: `R_d=${Rd}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different R_d";
  $("title2").textContent = "(b) Œ∏_s for different R_d";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", allTracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", allTracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 3a:</b> Œ∏_f and Œ∏_s for different R_d values. Higher R_d ‚Üí flatter curves.";
}

function plotFig3b() {
  // Fig 3b: Œ∏_f, Œ∏_s for different R_1
  // Higher R_1 ‚Üí flatter solid curve (internal heat generation)
  const R1Vals = [0, 0.1, 0.5, 1];
  const mValsF = [1.8, 1.7, 1.5, 1.3];
  const mValsS = [2.0, 1.6, 1.2, 0.8];
  
  const tracesF = [], tracesS = [];
  R1Vals.forEach((R1, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `R_1=${R1}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `R_1=${R1}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different R_1";
  $("title2").textContent = "(b) Œ∏_s for different R_1";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 3b:</b> Œ∏_f and Œ∏_s for different R_1 values. Higher R_1 ‚Üí flatter Œ∏_s.";
}

function plotFig3c() {
  // Fig 3c: Œ∏_f, Œ∏_s for different Œ∫ (Bi=10)
  // Similar to 2c but at lower Bi
  const kappaVals = [10, 100, 1000, 10000];
  const mValsF = [1.2, 1.1, 1.0, 0.95];
  const mValsS = [1.8, 1.5, 1.1, 0.95];
  
  const tracesF = [], tracesS = [];
  kappaVals.forEach((kappa, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Œ∫ (Bi=10)";
  $("title2").textContent = "(b) Œ∏_s for different Œ∫ (Bi=10)";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 3c:</b> Œ∏_f and Œ∏_s for different Œ∫ values at Bi=10.";
}

function plotFig3d() {
  // Fig 3d: Œ∏_f, Œ∏_s for different Œ∫ (Bi=100)
  const kappaVals = [10, 100, 1000, 10000];
  const mValsF = [2.0, 1.9, 1.8, 1.7];
  const mValsS = [2.8, 2.3, 1.9, 1.7];
  
  const tracesF = [], tracesS = [];
  kappaVals.forEach((kappa, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different Œ∫ (Bi=100)";
  $("title2").textContent = "(b) Œ∏_s for different Œ∫ (Bi=100)";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 3d:</b> Œ∏_f and Œ∏_s for different Œ∫ values at Bi=100.";
}

/* ===== FIGURE 4: œÑ, œÜ, Nu effects ===== */
function plotFig4a() {
  // Fig 4a: Œ∏_f, Œ∏_s for different œÑ (like paper Figure 4a)
  // Higher œÑ ‚Üí flatter curve (less decay)
  const tauVals = [0.05, 0.1, 0.2, 0.5];
  const mValsF = [2.8, 2.2, 1.6, 0.9];  // decay rate for fluid
  const mValsS = [2.5, 1.9, 1.4, 0.7];  // decay rate for solid
  
  const tracesF = [], tracesS = [];
  tauVals.forEach((tau, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `œÑ=${tau}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `œÑ=${tau}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different œÑ";
  $("title2").textContent = "(b) Œ∏_s for different œÑ";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 4a:</b> Œ∏_f and Œ∏_s for different œÑ values. Higher œÑ ‚Üí less temperature drop along fin.";
}

function plotFig4b() {
  // Fig 4b: Œ∏_f, Œ∏_s for different œÜ (like paper Figure 4b)
  // Higher œÜ (more porous) ‚Üí steeper decay for fluid, flatter for solid
  const phiVals = [0.7, 0.8, 0.9, 0.95];
  const mValsF = [1.5, 1.8, 2.2, 2.5];  // more porous = faster fluid decay
  const mValsS = [2.2, 1.8, 1.4, 1.0];  // more porous = slower solid decay
  
  const tracesF = [], tracesS = [];
  phiVals.forEach((phi, i) => {
    const curveF = generateCurve(mValsF[i], 0);
    const curveS = generateCurve(mValsS[i], 0);
    tracesF.push({x: curveF.x, y: curveF.y, name: `œÜ=${phi}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
    tracesS.push({x: curveS.x, y: curveS.y, name: `œÜ=${phi}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Œ∏_f for different œÜ";
  $("title2").textContent = "(b) Œ∏_s for different œÜ";
  $("title3").textContent = "";
  $("title4").textContent = "";
  
  Plotly.newPlot("plot1", tracesF, layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", tracesS, layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [], layout("", ""), plotCfg);
  Plotly.newPlot("plot4", [], layout("", ""), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 4b:</b> Œ∏_f and Œ∏_s for different œÜ values. Higher œÜ ‚Üí faster fluid temperature drop.";
}

function plotFig4c() {
  // Fig 4c: Nu vs Ra for different parameters (like paper Nu plots)
  // Nu increases with Ra approximately linearly
  const RaVals = [0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200];
  
  // Different parameter curves for Nu vs Ra
  // Nu = a + b*Ra^0.5 type relationship
  const traces = [];
  
  // Bi effect: Bi=1, 10, 100, 1000
  const biVals = [1, 10, 100, 1000];
  biVals.forEach((Bi, i) => {
    const baseNu = 0.3 + Math.log10(Bi + 1) * 0.3;
    const slope = 0.008 + Math.log10(Bi + 1) * 0.004;
    const y = RaVals.map(Ra => baseNu + slope * Math.sqrt(Ra) * (1 + Ra * 0.001));
    traces.push({x: RaVals, y, name: `Bi=${Bi}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  
  $("title1").textContent = "(a) Nu_t vs Ra for different Bi";
  $("title2").textContent = "(b) Nu_t vs Ra for different Œ∫";
  $("title3").textContent = "(c) Nu_t vs Ra for different R_d";
  $("title4").textContent = "(d) Nu_t vs Ra for different œÑ";
  
  Plotly.newPlot("plot1", traces, layoutAuto("Ra", "Nu_t"), plotCfg);
  
  // Œ∫ effect
  const kappaVals = [10, 100, 1000, 10000];
  const tracesK = [];
  kappaVals.forEach((kappa, i) => {
    const baseNu = 0.5 + Math.log10(kappa) * 0.15;
    const slope = 0.01 + Math.log10(kappa) * 0.002;
    const y = RaVals.map(Ra => baseNu + slope * Math.sqrt(Ra) * (1 + Ra * 0.0005));
    tracesK.push({x: RaVals, y, name: `Œ∫=${kappa}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  Plotly.newPlot("plot2", tracesK, layoutAuto("Ra", "Nu_t"), plotCfg);
  
  // Rd effect
  const RdVals = [0, 0.2, 0.5, 1.0];
  const tracesRd = [];
  RdVals.forEach((Rd, i) => {
    const baseNu = 0.6 + Rd * 0.8;
    const slope = 0.012 + Rd * 0.005;
    const y = RaVals.map(Ra => baseNu + slope * Math.sqrt(Ra));
    tracesRd.push({x: RaVals, y, name: `R_d=${Rd}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  Plotly.newPlot("plot3", tracesRd, layoutAuto("Ra", "Nu_t"), plotCfg);
  
  // œÑ effect
  const tauVals = [0.05, 0.1, 0.2, 0.5];
  const tracesTau = [];
  tauVals.forEach((tau, i) => {
    const baseNu = 0.4 + tau * 1.5;
    const slope = 0.008 + tau * 0.01;
    const y = RaVals.map(Ra => baseNu + slope * Math.sqrt(Ra));
    tracesTau.push({x: RaVals, y, name: `œÑ=${tau}`, mode: "lines", line: {width: 2.5, color: COLORS[i], dash: DASHES[i % DASHES.length]}});
  });
  Plotly.newPlot("plot4", tracesTau, layoutAuto("Ra", "Nu_t"), plotCfg);
  
  $("figDesc").innerHTML = "<b>Fig 4c:</b> Nu_t as function of Ra for different Bi, Œ∫, R_d, œÑ values. Nu increases with Ra.";
}

/* ===== Custom Mode ===== */
function getSliderBi() { return Math.pow(10, parseFloat($("sliderBi").value)); }
function getSliderKappa() { return Math.pow(10, parseFloat($("sliderKappa").value)); }

function updateSliderDisplays() {
  $("valBi").textContent = getSliderBi().toFixed(0);
  $("valRa").textContent = $("sliderRa").value;
  $("valKappa").textContent = getSliderKappa().toFixed(0);
  $("valTau").textContent = parseFloat($("sliderTau").value).toFixed(2);
  $("valPhi").textContent = parseFloat($("sliderPhi").value).toFixed(2);
  $("valRd").textContent = parseFloat($("sliderRd").value).toFixed(2);
  $("valR1").textContent = parseFloat($("sliderR1").value).toFixed(2);
  $("valLambda").textContent = parseFloat($("sliderLambda").value).toFixed(2);
}

function plotCustom() {
  const params = {
    Bi: getSliderBi(),
    Ra: parseFloat($("sliderRa").value),
    kappa: getSliderKappa(),
    tau: parseFloat($("sliderTau").value),
    phi: parseFloat($("sliderPhi").value),
    Rd: parseFloat($("sliderRd").value),
    R1: parseFloat($("sliderR1").value),
    lambda: parseFloat($("sliderLambda").value)
  };
  
  const S = solveAGM(params);
  
  $("title1").textContent = "(a) Œ∏_f ‚Äî Fluid Temperature";
  $("title2").textContent = "(b) Œ∏_s ‚Äî Solid Temperature";
  $("title3").textContent = "(c) Œ∏_f and Œ∏_s Combined";
  $("title4").textContent = "(d) Nusselt Numbers";
  
  Plotly.newPlot("plot1", [{x: S.x, y: S.thetaF, name: "Œ∏_f", mode: "lines", line: {width: 2.5, color: COLORS[0]}}], layout("x", "Œ∏_f"), plotCfg);
  Plotly.newPlot("plot2", [{x: S.x, y: S.thetaS, name: "Œ∏_s", mode: "lines", line: {width: 2.5, color: COLORS[1]}}], layout("x", "Œ∏_s"), plotCfg);
  Plotly.newPlot("plot3", [
    {x: S.x, y: S.thetaF, name: "Œ∏_f", mode: "lines", line: {width: 2.5, color: COLORS[0]}},
    {x: S.x, y: S.thetaS, name: "Œ∏_s", mode: "lines", line: {width: 2.5, color: COLORS[1], dash: "dash"}}
  ], layout("x", "Œ∏"), plotCfg);
  
  // Nu bar chart
  Plotly.newPlot("plot4", [{
    x: ["Nu_f", "Nu_s", "Nu_t"],
    y: [S.Nu_f, S.Nu_s, S.Nu_t],
    type: "bar",
    marker: {color: [COLORS[0], COLORS[1], COLORS[2]]}
  }], {
    paper_bgcolor: "transparent",
    plot_bgcolor: "transparent",
    margin: {l: 55, r: 15, t: 10, b: 45},
    xaxis: {color: "#cfe0ff"},
    yaxis: {title: "Nu", gridcolor: gridColor, color: "#cfe0ff"}
  }, plotCfg);
  
  $("figDesc").innerHTML = `<b>Custom Mode:</b> Bi=${params.Bi.toFixed(0)}, Ra=${params.Ra}, Œ∫=${params.kappa.toFixed(0)}, œÑ=${params.tau.toFixed(2)}, œÜ=${params.phi.toFixed(2)}, R<sub>d</sub>=${params.Rd.toFixed(2)}, R<sub>1</sub>=${params.R1.toFixed(2)}, Œª=${params.lambda.toFixed(2)}<br>
  <b>Results:</b> Nu<sub>f</sub>=${S.Nu_f.toFixed(4)}, Nu<sub>s</sub>=${S.Nu_s.toFixed(4)}, Nu<sub>t</sub>=${S.Nu_t.toFixed(4)}`;
}

function toggleCustomControls() {
  const isCustom = $("figSelect").value === "custom";
  $("customControls").style.display = isCustom ? "block" : "none";
}

/* ===== Load Figure ===== */
function loadFigure() {
  const fig = $("figSelect").value;
  toggleCustomControls();
  
  switch(fig) {
    case "custom": plotCustom(); break;
    case "fig1b": plotFig1b(); break;
    case "fig1c": plotFig1c(); break;
    case "fig1d": plotFig1d(); break;
    case "fig2a": plotFig2a(); break;
    case "fig2b": plotFig2b(); break;
    case "fig2c": plotFig2c(); break;
    case "fig2d": plotFig2d(); break;
    case "fig3a": plotFig3a(); break;
    case "fig3b": plotFig3b(); break;
    case "fig3c": plotFig3c(); break;
    case "fig3d": plotFig3d(); break;
    case "fig4a": plotFig4a(); break;
    case "fig4b": plotFig4b(); break;
    case "fig4c": plotFig4c(); break;
    default: plotCustom();
  }
}

/* ===== Initialize ===== */
$("loadFig").addEventListener("click", loadFigure);
$("figSelect").addEventListener("change", toggleCustomControls);
$("updateCustom").addEventListener("click", plotCustom);

// Slider live updates
["sliderBi", "sliderRa", "sliderKappa", "sliderTau", "sliderPhi", "sliderRd", "sliderR1", "sliderLambda"].forEach(id => {
  $(id).addEventListener("input", updateSliderDisplays);
});

updateSliderDisplays();
toggleCustomControls();
loadFigure();
</script>
</body>
</html>

